# Claude Session Notes

> This file contains breadcrumbs for Claude to quickly understand project context in new sessions.

## Project Overview

**ChasingMana** - Full-stack weather application
- **Backend**: Python FastAPI (port 8000)
- **Frontend**: React + TypeScript + Vite (port 5173)
- **API**: OpenWeatherMap (key in `backend/.env`)

## Current State (as of 2026-01-14)

### Completed Work

1. **Phase 1: Core Application** (commit `6949730`)
   - FastAPI backend with geocoding and weather endpoints
   - React frontend with location search and weather display
   - Vite dev server proxies `/api` to backend

2. **Bug Fix** (commit `990a9da`)
   - Fixed `ForecastResponse.timezone` type: `str` â†’ `int`
   - OpenWeatherMap returns timezone as seconds offset (int), not string

3. **Phase 1 Testing Infrastructure** (commit `01408d2`)
   - Backend: pytest with unit, integration, and Schemathesis tests
   - Frontend: Vitest + React Testing Library
   - E2E: Playwright for Python (requires both servers running)

4. **Code Review Fixes** (pending commit)
   - **P1 Fixed**: `API_BASE` now reads `VITE_API_URL` for production deployments
   - **P1 Fixed**: E2E selector - added `weather-card` class and `data-testid` to CurrentWeatherCard
   - **P1 Fixed**: Timestamps now use UTC with timezone offset for forecast grouping
   - **P2 Fixed**: Frontend `ForecastResponse.timezone` type changed to `number | null`
   - **P2 Fixed**: Added AbortController to LocationSearch to prevent race conditions
   - **Cleanup**: Removed unused `from_openweathermap_daily` method
   - **Cleanup**: Removed unused `reverse` geocoding method and tests
   - **Added**: Root test runner script (`scripts/test.sh`)

### Test Commands

```bash
# All tests (from project root)
./scripts/test.sh

# Backend (from backend/)
pytest                    # All tests except E2E
pytest -m e2e            # E2E only (needs servers running)

# Frontend (from frontend/)
npm test                 # Watch mode
npm run test:run         # Single run
```

### Key Files

| Purpose | Location |
|---------|----------|
| Backend entry | `backend/main.py` |
| Backend config | `backend/config.py` |
| API routes | `backend/routers/` |
| Services | `backend/services/` |
| Backend tests | `backend/tests/` |
| Frontend entry | `frontend/src/main.tsx` |
| Weather page | `frontend/src/pages/WeatherPage.tsx` |
| Frontend tests | `frontend/src/test/` |
| Test runner | `scripts/test.sh` |

### Environment Setup

```bash
# Backend
cd backend
source venv/bin/activate  # or .venv if using project root venv
pip install -r requirements.txt
cp .env.example .env      # Add OPENWEATHERMAP_API_KEY
uvicorn main:app --reload --port 8000

# Frontend
cd frontend
npm install
npm run dev
```

## Architecture Notes

- **Timestamps**: All backend timestamps are UTC-aware. Forecast grouping uses the location's timezone offset from the API.
- **API Base**: Frontend uses `VITE_API_URL` env var for production; empty string (proxy) for dev.
- **Search**: LocationSearch uses AbortController to cancel stale requests during fast typing.

## Known Issues / Notes

- Frontend `node_modules/` and `package-lock.json` are untracked (not in .gitignore yet)
- E2E tests require both backend and frontend servers running
- Schemathesis requires experimental OpenAPI 3.1 support enabled

## Potential Next Steps

- [ ] Add `.gitignore` for node_modules, __pycache__, .env, etc.
- [ ] Set up CI/CD (GitHub Actions workflow is documented in README)
- [ ] Add more E2E test scenarios
- [ ] Production deployment configuration
- [ ] Error handling improvements
- [ ] Loading states and UX polish

## Git Status

- Branch: `main`
- Pending commit with code review fixes

---
*Last updated: 2026-01-14 by Claude*
